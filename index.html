<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>3D Driving Game — idex.html</title>
  <style>
    html,body{height:100%;margin:0;background:#111;color:#eee;font-family:Inter,system-ui,Segoe UI,Roboto,'Helvetica Neue',Arial}
    #container{width:100%;height:100%;overflow:hidden;display:block}
    #ui{position:fixed;left:12px;top:12px;z-index:5;backdrop-filter:blur(6px);padding:8px 12px;border-radius:8px;background:rgba(0,0,0,0.35);box-shadow:0 6px 24px rgba(0,0,0,0.5)}
    #instructions{position:fixed;right:12px;bottom:12px;z-index:5;background:rgba(0,0,0,0.25);padding:8px 12px;border-radius:8px}
    .btn{appearance:none;border:0;background:#2b2b2b;color:#fff;padding:6px 10px;border-radius:6px;cursor:pointer}
  </style>
</head>
<body>
  <div id="container"></div>
  <div id="ui">
    <div style="font-weight:700">3D Driving — Demo</div>
    <div id="speed">Speed: 0 km/h</div>
    <div id="lap" style="opacity:.8;font-size:13px">Position: free roam</div>
    <div style="margin-top:8px"><button id="reset" class="btn">Reset</button></div>
  </div>
  <div id="instructions">
    <div><strong>Controls</strong></div>
    <div>W / ↑ : accelerate</div>
    <div>S / ↓ : brake/reverse</div>
    <div>A / ← : steer left</div>
    <div>D / → : steer right</div>
    <div>Space : handbrake</div>
  </div>

  <!-- Three.js from CDN -->
  <script src="https://unpkg.com/three@0.152.2/build/three.min.js"></script>

  <script>
  // Simple 3D driving game implemented in a single HTML file.
  // - Car is a box, physics are simplified (velocity, friction, steering)
  // - Camera follows behind the car
  // - Easy to extend: swapping models, adding track, obstacles, collisions

  const container = document.getElementById('container');
  const speedEl = document.getElementById('speed');
  const resetBtn = document.getElementById('reset');

  // Setup renderer
  const renderer = new THREE.WebGLRenderer({antialias:true});
  renderer.setPixelRatio(window.devicePixelRatio);
  renderer.setSize(window.innerWidth, window.innerHeight);
  renderer.outputEncoding = THREE.sRGBEncoding;
  container.appendChild(renderer.domElement);

  // Scene & camera
  const scene = new THREE.Scene();
  scene.background = new THREE.Color(0x87ceeb);

  const camera = new THREE.PerspectiveCamera(60, window.innerWidth/window.innerHeight, 0.1, 2000);
  camera.position.set(0,5,-12);
  camera.lookAt(0,0,0);

  // Lights
  const hemi = new THREE.HemisphereLight(0xffffff, 0x444444, 0.8);
  hemi.position.set(0,50,0);
  scene.add(hemi);
  const dir = new THREE.DirectionalLight(0xffffff, 0.6);
  dir.position.set(5,10,2);
  scene.add(dir);

  // Ground / track
  const groundGeo = new THREE.PlaneGeometry(200,200);
  const groundMat = new THREE.MeshStandardMaterial({color:0x2b7a2b,roughness:0.9});
  const ground = new THREE.Mesh(groundGeo, groundMat);
  ground.rotation.x = -Math.PI/2;
  ground.receiveShadow = true;
  scene.add(ground);

  // Road (a simple curved road made from boxes) - for visual reference
  const road = new THREE.Group();
  const roadMat = new THREE.MeshStandardMaterial({color:0x333333,metalness:0.1,roughness:0.9});
  for(let i=0;i<40;i++){
    const seg = new THREE.Mesh(new THREE.BoxGeometry(6,0.05,6), roadMat);
    seg.position.set(Math.sin(i*0.2)*20, 0.01, i*4 - 60);
    seg.rotation.y = Math.sin(i*0.2)*0.25;
    road.add(seg);
  }
  scene.add(road);

  // Simple car body (box) and wheels (cylinders)
  const car = new THREE.Group();
  const body = new THREE.Mesh(new THREE.BoxGeometry(1.8,0.6,4), new THREE.MeshStandardMaterial({color:0xff3333,metalness:0.2,roughness:0.6}));
  body.position.y = 0.6;
  car.add(body);

  const wheelGeo = new THREE.CylinderGeometry(0.35,0.35,0.4,16);
  const wheelMat = new THREE.MeshStandardMaterial({color:0x111111,metalness:0.5});
  function makeWheel(x,z){
    const w = new THREE.Mesh(wheelGeo, wheelMat);
    w.rotation.z = Math.PI/2;
    w.position.set(x,0.35,z);
    car.add(w);
    return w;
  }
  makeWheel(-0.9,1.4);
  makeWheel(0.9,1.4);
  makeWheel(-0.9,-1.4);
  makeWheel(0.9,-1.4);

  car.position.set(0,0,0);
  scene.add(car);

  // Simple obstacles
  const boxMat = new THREE.MeshStandardMaterial({color:0x8b5a2b});
  for(let i=0;i<10;i++){
    const b = new THREE.Mesh(new THREE.BoxGeometry(2,2,2), boxMat);
    b.position.set((Math.random()-0.5)*60,1,(Math.random()*120)-60);
    scene.add(b);
  }

  // Game state (very simple physics)
  const state = {
    speed:0, // in units/s
    maxSpeed:40, // arbitrary units
    accel:30, // units/s^2
    brake:60,
    friction:8,
    steerAngle:0, // radians
    maxSteer:Math.PI/6,
    steerSpeed:2.5, // how fast steering input changes
    velocity: new THREE.Vector3(0,0,0)
  };

  const keys = {forward:false,back:false,left:false,right:false,brake:false};

  function updateControls(dt){
    // speed control
    const forwardInput = keys.forward ? 1:0;
    const backInput = keys.back ? 1:0;

    // accelerate
    if(forwardInput){
      state.speed += state.accel * dt;
    }
    if(backInput){
      state.speed -= state.brake * dt;
    }

    // friction
    if(!forwardInput && !backInput){
      if(state.speed>0){ state.speed -= state.friction * dt; if(state.speed<0) state.speed=0; }
      else if(state.speed<0){ state.speed += state.friction * dt; if(state.speed>0) state.speed=0; }
    }

    // clamp speed
    const top = state.maxSpeed;
    if(state.speed>top) state.speed = top;
    if(state.speed < -top*0.4) state.speed = -top*0.4; // reverse slower

    // steering
    const leftInput = keys.left ? 1:0;
    const rightInput = keys.right ? 1:0;
